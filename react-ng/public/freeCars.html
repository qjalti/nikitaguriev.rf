<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <link
            href="https://fonts.cdnfonts.com/css/sf-pro-display"
            rel="stylesheet"
    />
    <title>–ê–≤—Ç–æ–í–æ–ª–µ–π–±–æ–ª</title>
    <style>
        * {
            transition: all 125ms cubic-bezier(0.4, 0, 0.2, 1) !important;
        }

        body {
            font-family: 'SF Pro Display', sans-serif !important;
            max-width: 800px;
            margin: 16px auto;
            background: rgba(21, 18, 24, 1) !important;
            color: rgba(255, 255, 255, 0.875) !important;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.125);
        }

        h1,
        h2 {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        h1 svg {
            width: 32px;
            height: 32px;
            fill: rgba(255, 255, 255, 0.875);
        }

        .car {
            background: rgba(18, 18, 18, 0.875);
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(18, 18, 18, 0.125);
        }

        .car h3 {
            margin-bottom: 8px;
        }

        .car-diagram {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 8px;
            justify-items: center;
            align-items: center;
            margin-top: 8px;
        }

        .seat {
            padding: 8px;
            background: rgba(224, 224, 224, 0.875);
            border-radius: 8px;
            min-width: 140px;
            text-align: center;
            cursor: pointer;
        }

        .seat.taken {
            background: rgba(183, 28, 28, 0.875);
            cursor: not-allowed;
        }

        .seat.free {
            background: rgba(27, 94, 32, 0.875);
        }

        form {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        input,
        select,
        button {
            padding: 8px;
            font-size: 1em;
            color: rgba(255, 255, 255, 0.875);
        }

        button.reset {
            background: rgba(183, 28, 28, 0.875);
            color: rgba(255, 255, 255, 0.875);
            border: none;
            border-radius: 5px;
        }

        .label {
            font-size: 0.875em;
            color: rgba(255, 255, 255, 0.875);
        }

        .car h4 {
            display: flex;
            gap: 8px;
            justify-content: start;
            align-items: center;
        }

        .car svg {
            width: 24px;
            fill: rgba(255, 255, 255, 0.875);
        }

        .car .wa {
            fill: rgba(27, 94, 32, 0.875);
        }

        .car .call {
            fill: rgba(13, 71, 161, 0.875);
        }

        #carContainer {
            background: rgba(18, 18, 18, 0.875);
        }
    </style>
</head>

<body>
<h1>
    <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 -960 960 960"
    >
        <path d="M240-200v40q0 17-11.5 28.5T200-120h-40q-17 0-28.5-11.5T120-160v-320l84-240q6-18 21.5-29t34.5-11h440q19 0 34.5 11t21.5 29l84 240v320q0 17-11.5 28.5T800-120h-40q-17 0-28.5-11.5T720-160v-40H240Zm-8-360h496l-42-120H274l-42 120Zm-32 80v200-200Zm100 160q25 0 42.5-17.5T360-380q0-25-17.5-42.5T300-440q-25 0-42.5 17.5T240-380q0 25 17.5 42.5T300-320Zm360 0q25 0 42.5-17.5T720-380q0-25-17.5-42.5T660-440q-25 0-42.5 17.5T600-380q0 25 17.5 42.5T660-320Zm-460 40h560v-200H200v200Z"/>
    </svg>
    –ê–≤—Ç–æ–í–æ–ª–µ–π–±–æ–ª
</h1>
<div id="carContainer"></div>
<h2>üìã –ó–∞–ø–∏—Å—å</h2>
<form id="joinForm">
    <input type="text" id="passengerName" placeholder="–í–∞—à–µ –∏–º—è" required/>
    <select id="carSelect"></select>
    <select id="seatSelect"></select>
    <button type="submit">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
</form>
<button class="reset" onclick="resetAll()">
    üîÑ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ (–≤—Ä—É—á–Ω—É—é)
</button>

<script>
  const cars = [
    {
      id: 1,
      driver: {
        name: '–ù–∏–∫–∏—Ç–∞ –ì—É—Ä–∏–µ–≤',
        number: '79883857654',
      },
      car: {
        model: 'KIA RIO',
        number: '–û 746 –•–ù 123',
        color: '–ë–µ–ª–∞—è',
      },
      seats: {
        front: null,
        'back-left': null,
        'back-middle': null,
        'back-right': null,
      },
    },
    {
      id: 2,
      driver: {
        name: '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –í–æ—Ä–æ–Ω–∏–Ω–∞',
        number: '79091666647',
      },
      car: {
        model: 'Nissan X-Trail',
        number: '–û 000 –û–û 000',
        color: '–ß—ë—Ä–Ω–∞—è',
      },
      seats: {
        front: null,
        'back-left': null,
        'back-middle': null,
        'back-right': null,
      },
    },
    {
      id: 3,
      driver: {
        name: '–í–∏—Ç–∞–ª–∏–π –°–≤–µ—Ç–∞—à–æ–≤',
        number: '79265786314',
      },
      car: {
        model: 'Mazda RX-8',
        number: '–û 000 –û–û 000',
        color: '–ì–æ–ª—É–±–∞—è',
      },
      seats: {
        front: null,
        'back-left': null,
        'back-middle': null,
        'back-right': null,
      },
    },
  ];

  const seatLabels = {
    front: '–ü–∞—Å—Å–∞–∂–∏—Ä —Å–ø–µ—Ä–µ–¥–∏',
    'back-left': '–°–∑–∞–¥–∏ —Å–ª–µ–≤–∞',
    'back-middle': '–°–∑–∞–¥–∏ —Ü–µ–Ω—Ç—Ä (–º–µ–Ω–µ–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ)',
    'back-right': '–°–∑–∞–¥–∏ —Å–ø—Ä–∞–≤–∞',
  };

  const localKey = 'carpoolData';

  function loadData() {
    const saved = localStorage.getItem(localKey);
    if (saved) {
      const parsed = JSON.parse(saved);
      parsed.forEach((dataCar, i) => {
        cars[i].seats = dataCar.seats;
      });
    }
  }

  function saveData() {
    localStorage.setItem(localKey, JSON.stringify(cars));
  }

  function renderCars() {
    const container = document.getElementById('carContainer');
    container.innerHTML = '';
    cars.forEach((car) => {
      const div = document.createElement('div');
      div.className = 'car';
      div.innerHTML = `<h3>–ú–∞—à–∏–Ω–∞ ‚Ññ${car.id}</h3>
<h4>–í–æ–¥–∏—Ç–µ–ª—å: ${car.driver.name}<a href="tel:+${car.driver.number}" title="–ü–æ–∑–≤–æ–Ω–∏—Ç—å"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" class="call"><path d="M760-480q0-117-81.5-198.5T480-760v-80q75 0 140.5 28.5t114 77q48.5 48.5 77 114T840-480h-80Zm-160 0q0-50-35-85t-85-35v-80q83 0 141.5 58.5T680-480h-80Zm198 360q-125 0-247-54.5T329-329Q229-429 174.5-551T120-798q0-18 12-30t30-12h162q14 0 25 9.5t13 22.5l26 140q2 16-1 27t-11 19l-97 98q20 37 47.5 71.5T387-386q31 31 65 57.5t72 48.5l94-94q9-9 23.5-13.5T670-390l138 28q14 4 23 14.5t9 23.5v162q0 18-12 30t-30 12ZM241-600l66-66-17-94h-89q5 41 14 81t26 79Zm358 358q39 17 79.5 27t81.5 13v-88l-94-19-67 67ZM241-600Zm358 358Z"/></svg></a><a href="https://wa.me/${car.driver.number}" title="–ù–∞–ø–∏—Å–∞—Ç—å –≤ WhatsApp"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="wa"><path d="M16.75 13.96c.25.13.41.2.46.3.06.11.04.61-.21 1.18-.2.56-1.24 1.1-1.7 1.12-.46.02-.47.36-2.96-.73-2.49-1.09-3.99-3.75-4.11-3.92-.12-.17-.96-1.38-.92-2.61.05-1.22.69-1.8.95-2.04.24-.26.51-.29.68-.26h.47c.15 0 .36-.06.55.45l.69 1.87c.06.13.1.28.01.44l-.27.41-.39.42c-.12.12-.26.25-.12.5.12.26.62 1.09 1.32 1.78.91.88 1.71 1.17 1.95 1.3.24.14.39.12.54-.04l.81-.94c.19-.25.35-.19.58-.11l1.67.88M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10c-1.97 0-3.8-.57-5.35-1.55L2 22l1.55-4.65A9.969 9.969 0 0 1 2 12 10 10 0 0 1 12 2m0 2a8 8 0 0 0-8 8c0 1.72.54 3.31 1.46 4.61L4.5 19.5l2.89-.96A7.95 7.95 0 0 0 12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8z"></path></svg></a></h4>
<h5>${car.car.color}, ${car.car.model}, ${car.car.number}</h5>`;

      const seatsDiv = document.createElement('div');
      seatsDiv.className = 'car-diagram';

      // –°—Ö–µ–º–∞: –∑–∞–¥–Ω–∏–π —Ä—è–¥ (3 –º–µ—Å—Ç–∞)
      ['back-left', 'back-middle', 'back-right'].forEach((seat) => {
        const seatDiv = document.createElement('div');
        seatDiv.className = 'seat';
        seatDiv.innerHTML =
            `<div class="label">${seatLabels[seat]}</div>` +
            (car.seats[seat] || '–°–≤–æ–±–æ–¥–Ω–æ');
        seatDiv.classList.add(car.seats[seat] ? 'taken' : 'free');
        seatsDiv.appendChild(seatDiv);
      });

      // –ü—Ä–æ–º–µ–∂—É—Ç–æ–∫
      const gap = document.createElement('div');
      gap.style.gridColumn = '2 / span 1';
      seatsDiv.appendChild(gap);

      // –ü–µ—Ä–µ–¥–Ω–µ–µ –ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–æ–µ –º–µ—Å—Ç–æ
      const frontDiv = document.createElement('div');
      frontDiv.className = 'seat';
      frontDiv.innerHTML =
          `<div class="label">${seatLabels['front']}</div>` +
          (car.seats['front'] || '–°–≤–æ–±–æ–¥–Ω–æ');
      frontDiv.classList.add(car.seats['front'] ? 'taken' : 'free');
      frontDiv.style.gridColumn = '2 / span 1';
      seatsDiv.appendChild(frontDiv);

      div.appendChild(seatsDiv);
      container.appendChild(div);
    });

    const carSelect = document.getElementById('carSelect');
    carSelect.innerHTML = cars
        .map(
            (car) =>
                `<option value="${car.id}">–ú–∞—à–∏–Ω–∞ ${car.id} (${car.driver})</option>`
        )
        .join('');

    const seatSelect = document.getElementById('seatSelect');
    seatSelect.innerHTML = Object.keys(seatLabels)
        .map((seat) => `<option value="${seat}">${seatLabels[seat]}</option>`)
        .join('');
  }

  document
      .getElementById('joinForm')
      .addEventListener('submit', function (e) {
        e.preventDefault();
        const name = document.getElementById('passengerName').value.trim();
        const carId = parseInt(document.getElementById('carSelect').value);
        const seat = document.getElementById('seatSelect').value;

        const car = cars.find((c) => c.id === carId);
        if (car.seats[seat]) {
          alert('–≠—Ç–æ –º–µ—Å—Ç–æ —É–∂–µ –∑–∞–Ω—è—Ç–æ.');
          return;
        }

        for (let s in car.seats) {
          if (car.seats[s] === name) {
            alert('–í—ã —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ —ç—Ç—É –º–∞—à–∏–Ω—É.');
            return;
          }
        }

        car.seats[seat] = name;
        saveData();
        renderCars();
        this.reset();
      });

  function resetAll() {
    if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏?')) return;
    cars.forEach((car) => {
      for (let seat in car.seats) {
        car.seats[seat] = null;
      }
    });
    saveData();
    renderCars();
  }

  setInterval(() => {
    const now = new Date();
    if (
        now.getDay() === 3 &&
        now.getHours() === 22 &&
        now.getMinutes() === 0
    ) {
      resetAll();
    }
  }, 60000);

  loadData();
  renderCars();
</script>
</body>
</html>
